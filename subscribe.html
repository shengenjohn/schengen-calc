<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribe to Travel Compliance Pro</title>
    <script src="https://sandbox-web.squarecdn.com/v1/square.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .nav {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .nav a {
            color: white;
            text-decoration: none;
            margin: 0 20px;
            padding: 10px 20px;
            border-radius: 25px;
            transition: background 0.3s ease;
        }

        .nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .disclaimer-banner {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .pricing-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .pricing-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pricing-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 60px rgba(0,0,0,0.15);
        }

        .pricing-card.popular {
            border: 3px solid #667eea;
            transform: scale(1.05);
        }

        .popular-badge {
            position: absolute;
            top: 20px;
            right: -30px;
            background: #667eea;
            color: white;
            padding: 8px 40px;
            transform: rotate(45deg);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }

        .plan-price {
            font-size: 3rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 5px;
        }

        .plan-period {
            color: #666;
            margin-bottom: 10px;
        }

        .trial-notice {
            background: #e8f5e8;
            color: #2d5a3d;
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
        }

        .features-list {
            list-style: none;
            margin: 30px 0;
            text-align: left;
        }

        .features-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            padding-left: 30px;
        }

        .features-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .cta-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .cta-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            margin-top: 10px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .benefits-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .benefit-item {
            text-align: center;
            padding: 20px;
        }

        .benefit-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .comparison-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: #f8f9ff;
            font-weight: 600;
        }

        .comparison-table .our-app {
            background: #e8f5e8;
            font-weight: 600;
        }

        .testimonials {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .testimonial {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
            background: #f8f9ff;
            border-radius: 0 10px 10px 0;
        }

        .faq-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .faq-item {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }

        .faq-question {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .legal-disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            font-size: 0.9rem;
            color: #856404;
        }

        .security-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .security-badge {
            background: #f8f9ff;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Payment Form Styles */
        .payment-form {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .payment-form h3 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        #card-container {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            min-height: 50px;
            background: white;
        }

        /* Fallback card input styling if Square doesn't load */
        .card-input-fallback {
            display: none;
        }

        .card-input-fallback.active {
            display: block;
        }

        .card-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .card-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .card-number-group {
            flex: 2;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .pricing-card.popular {
                transform: none;
            }
            
            .container {
                padding: 10px;
            }

            .comparison-table {
                font-size: 0.9rem;
            }

            .nav a {
                margin: 0 10px;
                padding: 8px 15px;
            }

            .payment-form {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="/">Home</a>
            <a href="/schengen/">Calculator</a>
            <a href="/subscribe.html" class="active">Subscribe</a>
        </nav>

        <div class="header">
            <h1>Travel Compliance Pro</h1>
            <p>A more user-friendly Schengen calculator with clear explanations and detailed tracking to help you stay organized during your European travels.</p>
            <div class="disclaimer-banner">
                <strong>Important:</strong> This calculator is a helping tool only. It does not constitute a right to stay for any period. Border authorities make final decisions on entry and duration of stay.
            </div>
        </div>

        <div class="comparison-section">
            <h2 style="text-align: center; margin-bottom: 10px; color: #333;">Why Choose Our Calculator?</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">Based on our research of existing Schengen calculators, here's how we're different:</p>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Most Free Calculators</th>
                        <th class="our-app">Travel Compliance Pro</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>User Interface</strong></td>
                        <td>Basic date inputs, minimal guidance</td>
                        <td class="our-app">Visual calendar with clear explanations at every step</td>
                    </tr>
                    <tr>
                        <td><strong>Trip Planning</strong></td>
                        <td>Calculate one trip at a time</td>
                        <td class="our-app">Plan multiple future trips with conflict detection</td>
                    </tr>
                    <tr>
                        <td><strong>Explanations</strong></td>
                        <td>Show numbers only</td>
                        <td class="our-app">Detailed breakdowns of why you have X days remaining</td>
                    </tr>
                    <tr>
                        <td><strong>Error Prevention</strong></td>
                        <td>Basic warnings</td>
                        <td class="our-app">Proactive alerts before you risk overstaying</td>
                    </tr>
                    <tr>
                        <td><strong>Travel History</strong></td>
                        <td>Enter manually each time</td>
                        <td class="our-app">Saves your history with easy editing and organization</td>
                    </tr>
                    <tr>
                        <td><strong>Support</strong></td>
                        <td>No support available</td>
                        <td class="our-app">Direct email support to help with tool usage</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="pricing-section">
            <div class="pricing-card popular">
                <div class="popular-badge">Available Now</div>
                <div class="plan-name">Pro</div>
                <div class="plan-price">¬£3.99</div>
                <div class="plan-period">per month</div>
                <div class="trial-notice">
                    üéâ 14-day free trial included!
                </div>
                
                <ul class="features-list">
                    <li>Unlimited trip calculations</li>
                    <li>Visual calendar interface</li>
                    <li>Travel history tracking</li>
                    <li>Clear explanations for each calculation</li>
                    <li>Email reminders for important dates</li>
                    <li>Export your travel reports</li>
                    <li>Direct email support</li>
                    <li>Mobile-friendly design</li>
                </ul>
                
                <button class="cta-button" onclick="showPaymentForm()">
                    Start Free Trial
                </button>
                <div class="loading" id="loading-pro">
                    <div class="spinner"></div>
                    <p>Setting up your trial...</p>
                </div>
            </div>

            <div class="pricing-card" style="opacity: 0.7;">
                <div class="plan-name">Business</div>
                <div class="plan-price">¬£7.99</div>
                <div class="plan-period">per month</div>
                <div style="background: #f0f0f0; color: #666; padding: 10px; border-radius: 10px; margin: 20px 0; font-weight: 600;">
                    Coming Soon
                </div>
                
                <ul class="features-list">
                    <li>Everything in Pro, plus:</li>
                    <li>Multiple traveler profiles</li>
                    <li>Advanced trip analysis reports</li>
                    <li>Calendar app integration</li>
                    <li>Document storage with expiry alerts</li>
                    <li>Priority support</li>
                    <li>Custom notification settings</li>
                    <li>API access for business use</li>
                </ul>
                
                <button class="cta-button" disabled style="background: #ccc; cursor: not-allowed;">
                    Join Waitlist
                </button>
            </div>
        </div>

        <!-- Payment Form (Hidden by default) -->
        <div id="payment-form" class="payment-form">
            <h3>Complete Your Subscription</h3>
            <p style="text-align: center; margin-bottom: 30px; color: #666;">
                Start your 14-day free trial - no charge today!
            </p>
            
            <form id="square-form">
                <div class="form-group">
                    <label for="customer-email">Email Address:</label>
                    <input type="email" id="customer-email" name="email" required placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label for="customer-name">Full Name:</label>
                    <input type="text" id="customer-name" name="name" required placeholder="John Smith">
                </div>
                
                <div class="form-group">
                    <label>Card Information:</label>
                    <div id="card-container">
                        <div style="color: #666; font-size: 0.9rem; text-align: center; padding: 20px;">
                            Loading secure payment form...
                        </div>
                    </div>
                    
                    <!-- Fallback form if Square doesn't load -->
                    <div id="card-input-fallback" class="card-input-fallback">
                        <div class="card-row">
                            <div class="form-group card-number-group">
                                <label for="fallback-card-number">Card Number:</label>
                                <input type="text" id="fallback-card-number" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                        </div>
                        <div class="card-row">
                            <div class="form-group">
                                <label for="fallback-expiry">Expiry Date:</label>
                                <input type="text" id="fallback-expiry" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label for="fallback-cvv">CVV:</label>
                                <input type="text" id="fallback-cvv" placeholder="123" maxlength="4">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="fallback-name-on-card">Name on Card:</label>
                            <input type="text" id="fallback-name-on-card" placeholder="John Smith">
                        </div>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; font-size: 0.9rem; color: #856404; margin-top: 10px;">
                            ‚ö†Ô∏è Demo mode - No real payments will be processed
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="cta-button" id="square-pay-button">
                    Start Free Trial
                </button>
                
                <p style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: #666;">
                    You won't be charged until your 14-day trial ends. Cancel anytime.
                </p>
                
                <button type="button" onclick="hidePaymentForm()" style="background: #f8f9fa; color: #666; border: 2px solid #e1e5e9; padding: 10px 20px; border-radius: 25px; width: 100%; margin-top: 15px; cursor: pointer;">
                    ‚Üê Back to Plans
                </button>
            </form>
        </div>

        <div class="benefits-section">
            <h2 style="text-align: center; margin-bottom: 10px; color: #333;">What Makes This Tool Different</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">Designed to solve the common frustrations with existing Schengen calculators</p>
            
            <div class="benefits-grid">
                <div class="benefit-item">
                    <div class="benefit-icon">üìö</div>
                    <h3>Clear Explanations</h3>
                    <p>Unlike basic calculators that just show numbers, we explain WHY you have that many days remaining and HOW the 90/180 rule works.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">üóìÔ∏è</div>
                    <h3>Visual Planning</h3>
                    <p>See your allowance on every calendar date. Most calculators require you to guess entry dates - we show your options clearly.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">‚ö†Ô∏è</div>
                    <h3>Proactive Warnings</h3>
                    <p>Get alerted before potential conflicts. Many travelers only discover problems when it's too late to change plans.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">üéØ</div>
                    <h3>Direct Support</h3>
                    <p>Get helpful support when planning trips. We'll help you understand how the tool works and general Schengen rules.</p>
                </div>
            </div>
        </div>

        <div class="testimonials">
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Built Based on Real Traveler Frustrations</h2>
            
            <div class="testimonial">
                <p><em>"I tried several free Schengen calculators and kept getting different results for the same trips. I never understood why my allowance changed."</em></p>
                <strong>‚Äî Common feedback from travel forums</strong>
            </div>
            
            <div class="testimonial">
                <p><em>"Planning multiple European trips is a nightmare. I have to recalculate everything manually when one trip changes."</em></p>
                <strong>‚Äî Digital nomad community discussions</strong>
            </div>
            
            <div class="testimonial">
                <p><em>"Free calculators don't save anything. Every time I plan a trip, I have to re-enter months of travel history."</em></p>
                <strong>‚Äî Travel planning pain points research</strong>
            </div>
        </div>

        <div class="legal-disclaimer">
            <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Important Legal Information</h3>
            <p><strong>This application is a planning tool only and does not provide legal advice.</strong></p>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li>Calculations are based on current Schengen regulations as we understand them</li>
                <li>Border authorities have final say on entry, duration of stay, and compliance</li>
                <li>Immigration laws can change - always verify current requirements</li>
                <li>For complex situations, consult qualified immigration professionals</li>
                <li>Users are solely responsible for ensuring their compliance with all applicable laws</li>
            </ul>
            <p><em>By using this service, you acknowledge that we cannot guarantee entry or prevent overstay situations.</em></p>
        </div>

        <div class="faq-section">
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Frequently Asked Questions</h2>
            
            <div class="faq-item">
                <div class="faq-question">How does the 14-day free trial work?</div>
                <div class="faq-answer">Start using all features immediately. Your card is securely stored but you won't be charged until after 14 days. Cancel anytime during the trial at no cost.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Can I cancel anytime?</div>
                <div class="faq-answer">Yes! Cancel your subscription anytime with one click. No contracts, no cancellation fees. You'll keep access until the end of your current billing period.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">How accurate are the calculations?</div>
                <div class="faq-answer">Our algorithm is tested against the official EU calculator and based on current Schengen regulations. However, this is a planning tool only - border authorities make final decisions on entry and stay duration.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Is my payment information secure?</div>
                <div class="faq-answer">Yes. We use Square's secure payment processing with bank-level encryption. Your card details are never stored on our servers and we never see your full card number.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">What kind of support do you offer?</div>
                <div class="faq-answer">We provide direct email support to help you understand how the tool works and general Schengen rules. Response time is typically within 24 hours on business days. For specific legal advice about your immigration situation, we recommend consulting qualified immigration professionals.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Do you offer refunds?</div>
                <div class="faq-answer">Yes! We offer a 30-day money-back guarantee if you're not satisfied with the service quality.</div>
            </div>
        </div>

        <div class="security-badges">
            <div class="security-badge">
                üîí 256-bit SSL Encryption
            </div>
            <div class="security-badge">
                üí≥ Secure Square Payments
            </div>
            <div class="security-badge">
                üõ°Ô∏è GDPR Compliant
            </div>
            <div class="security-badge">
                ‚≠ê 30-Day Money Back
            </div>
        </div>
    </div>

    <script>
        // Safe element access utilities
        function safeElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element not found: ${id}`);
                return null;
            }
            return element;
        }

        function safeSetStyle(elementId, property, value) {
            const element = safeElement(elementId);
            if (element && element.style) {
                element.style[property] = value;
                return true;
            }
            return false;
        }

        function safeSetContent(elementId, content) {
            const element = safeElement(elementId);
            if (element) {
                element.textContent = content;
                return true;
            }
            return false;
        }

        function safeSetHTML(elementId, html) {
            const element = safeElement(elementId);
            if (element) {
                element.innerHTML = html;
                return true;
            }
            return false;
        }

        let squarePayments;
        let card;

        // Initialize Square Web Payments SDK with better fallback
        async function initializeSquare() {
            try {
                if (!window.Square) {
                    console.warn('Square Web Payments SDK not loaded - showing fallback form');
                    showFallbackForm();
                    return false;
                }

                // Replace with your Square Application ID
                squarePayments = Square.payments('sandbox-sq0idb-YOUR_SQUARE_APPLICATION_ID_HERE');
                
                card = await squarePayments.card();
                const cardContainer = safeElement('card-container');
                
                if (cardContainer) {
                    // Clear loading message
                    cardContainer.innerHTML = '';
                    await card.attach('#card-container');
                    console.log('Square initialized successfully');
                    return true;
                } else {
                    console.error('Card container not found');
                    showFallbackForm();
                    return false;
                }
                
            } catch (error) {
                console.error('Failed to initialize Square:', error);
                showFallbackForm();
                return false;
            }
        }

        // Show fallback form if Square fails to load
        function showFallbackForm() {
            const cardContainer = safeElement('card-container');
            const fallbackForm = safeElement('card-input-fallback');
            
            if (cardContainer) {
                cardContainer.style.display = 'none';
            }
            
            if (fallbackForm) {
                fallbackForm.classList.add('active');
                console.log('Fallback payment form activated');
            }
        }

        function showPaymentForm() {
            const paymentForm = safeElement('payment-form');
            if (paymentForm) {
                paymentForm.style.display = 'block';
                paymentForm.scrollIntoView({ behavior: 'smooth' });
                
                // Initialize Square if not already done
                if (!squarePayments) {
                    // Add a small delay to ensure the form is visible
                    setTimeout(() => {
                        initializeSquare();
                    }, 500);
                }
                
                // Track event
                trackEvent('payment_form_shown', { plan: 'pro' });
            }
        }

        function hidePaymentForm() {
            safeSetStyle('payment-form', 'display', 'none');
            const pricingSection = document.querySelector('.pricing-section');
            if (pricingSection) {
                pricingSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        async function handlePayment(event) {
            event.preventDefault();
            
            const submitButton = safeElement('square-pay-button');
            const loading = safeElement('loading-pro');
            
            if (!submitButton) {
                console.error('Submit button not found');
                return;
            }
            
            // Show loading state
            submitButton.disabled = true;
            submitButton.textContent = 'Processing...';
            
            try {
                // Get customer info with safe access
                const customerEmailElement = safeElement('customer-email');
                const customerNameElement = safeElement('customer-name');
                
                if (!customerEmailElement || !customerNameElement) {
                    throw new Error('Customer information fields not found');
                }
                
                const customerEmail = customerEmailElement.value;
                const customerName = customerNameElement.value;
                
                if (!customerEmail || !customerName) {
                    throw new Error('Please fill in all required fields');
                }
                
                // Check if card is initialized
                if (!card) {
                    throw new Error('Payment card not initialized');
                }
                
                // Tokenize card
                const result = await card.tokenize();
                
                if (result.status === 'OK') {
                    // In production, send this token to your backend
                    await processSubscription(result.token, customerEmail, customerName);
                } else {
                    throw new Error(result.errors?.[0]?.message || 'Card tokenization failed');
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                alert('Payment failed: ' + error.message);
                
                // Reset button state
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Start Free Trial';
                }
            }
        }

        async function processSubscription(token, email, name) {
            try {
                // Simulate API call to your backend
                // In production, this would create a subscription with Square
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // For demo - start the trial
                startTrial(email, name);
                
                alert(`üéâ Welcome to your 14-day free trial! You now have full access to Travel Compliance Pro. Visit the calculator to start planning your trips.`);
                
                // Track successful subscription
                trackEvent('subscription_started', { 
                    plan: 'pro',
                    email: email,
                    payment_method: 'square'
                });
                
                // Redirect to calculator
                setTimeout(() => {
                    window.location.href = '/schengen/';
                }, 2000);
                
            } catch (error) {
                console.error('Subscription processing error:', error);
                throw new Error('Failed to process subscription');
            }
        }

        function startTrial(email, name) {
            try {
                // Set trial end date (14 days from now)
                const trialEnd = new Date();
                trialEnd.setDate(trialEnd.getDate() + 14);
                
                localStorage.setItem('travelCompliance_trial_end', trialEnd.getTime().toString());
                localStorage.setItem('travelCompliance_trial_active', 'true');
                localStorage.setItem('travelCompliance_user_email', email);
                localStorage.setItem('travelCompliance_user_name', name);
                localStorage.setItem('travelCompliance_usage', '0'); // Reset usage count
                
            } catch (error) {
                console.error('Error starting trial:', error);
                throw new Error('Failed to start trial');
            }
        }

        // Form submission handler with comprehensive error handling
        function initializeForm() {
            const form = safeElement('square-form');
            if (form) {
                form.addEventListener('submit', handlePayment);
            } else {
                console.warn('Square form not found - payment functionality may be limited');
            }
        }

        // Analytics tracking with error handling
        function trackEvent(eventName, properties) {
            try {
                // In production, integrate with your analytics service
                console.log('Event:', eventName, properties);
            } catch (error) {
                console.warn('Analytics tracking error:', error);
            }
        }

        // Initialize page with comprehensive error handling
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initialize form handlers
                initializeForm();
                
                // Add entrance animations
                const cards = document.querySelectorAll('.pricing-card');
                cards.forEach((card, index) => {
                    if (card) {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(30px)';
                        
                        setTimeout(() => {
                            card.style.transition = 'all 0.6s ease';
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, index * 200);
                    }
                });
                
                // Track page visit
                trackEvent('subscription_page_visit', { 
                    payment_provider: 'square'
                });
                
                console.log('üîí Subscription page loaded successfully with Square integration');
                
            } catch (error) {
                console.error('Page initialization error:', error);
                // Continue with basic functionality even if some features fail
            }
        });

        // Track user interactions with error handling
        document.addEventListener('click', function(e) {
            try {
                if (e.target && e.target.classList.contains('cta-button')) {
                    trackEvent('cta_button_clicked', { 
                        button_text: e.target.textContent,
                        page: 'subscription',
                        payment_provider: 'square'
                    });
                }
            } catch (error) {
                console.warn('Click tracking error:', error);
            }
        });

        // Error boundary for unhandled errors
        window.addEventListener('error', function(e) {
            console.error('Unhandled error:', e.error);
            // Don't show error to user unless it's critical
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            e.preventDefault(); // Prevent the default browser error handling
        });
    </script>
</body>
</html>